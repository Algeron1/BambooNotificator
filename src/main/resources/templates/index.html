<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>RGS Bamboo Notifier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .status-success { color: #198754; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-in-progress { color: #ffc107; font-weight: bold; }
        .status-unknown { color: #6c757d; font-weight: bold; }
    </style>
</head>
<body class="p-4">

<div class="container">
    <h1 class="mb-4">–°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å—Ç–µ–Ω–¥–æ–≤ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h1>

    <div id="deploymentsList" class="row gy-3"></div>
</div>

<script>
    async function fetchDeployments() {
        const response = await fetch('/deployments');
        const deployments = await response.json();

        const container = document.getElementById('deploymentsList');
        container.innerHTML = '';

        deployments.forEach(deploy => {
            const statusClass = {
                'SUCCESS': 'status-success',
                'ERROR': 'status-error',
                'IN_PROGRESS': 'status-in-progress',
                'UNKNOWN': 'status-unknown'
            }[deploy.status] || 'status-unknown';

            const card = document.createElement('div');
            card.className = 'col-12 col-md-6 col-lg-4';
            card.innerHTML = `
            <div class="card shadow-sm">
              <div class="card-body">
                <h5 class="card-title">${deploy.environmentId}</h5>
                <p class="card-text">üì¶–í–µ—Ä—Å–∏—è: <strong>${deploy.deployVersion}</strong></p>
                <p class="card-text">üïì–°—Ç–∞—Ä—Ç: ${deploy.startedDate || '-'}</p>
                <p class="card-text">üïî–§–∏–Ω–∏—à: ${deploy.finishedDate || '-'}</p>
                <p class="card-text">üìä–°—Ç–∞—Ç—É—Å: <span class="${statusClass}">${deploy.status}</span></p>
                 <p class="card-text">üë®‚Äçüíª–ê–≤—Ç–æ—Ä: ${deploy.author || '-'}</p>
              </div>
            </div>
          `;
            container.appendChild(card);
        });
    }

    fetchDeployments();
    setInterval(fetchDeployments, 30000); // –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
